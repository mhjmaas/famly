# Data Model â€“ User Authentication Foundations

**Note**: All collections and schemas are managed by Better Auth library. This document describes the data model for reference only.

## User Collection (managed by Better Auth)

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `id` | string | Primary key | Generated by Better Auth |
| `email` | string | Required, unique, stored lowercase | Acts as login identifier |
| `emailVerified` | boolean | Required, default false | Email verification status |
| `name` | string | Optional | User display name |
| `image` | string | Optional | Profile image URL |
| `createdAt` | Date | Required, default now | Immutable audit stamp |
| `updatedAt` | Date | Required, auto-updated | Reflects last update |

### Password Management
- Better Auth handles all password hashing using secure algorithms
- Password policy: minimum 8 characters (enforced by Better Auth)
- Raw passwords never persisted - only secure hashes stored
- Duplicate emails rejected with case-insensitive uniqueness

## Session Collection (managed by Better Auth)

| Field | Type | Constraints | Notes |
|-------|------|-------------|-------|
| `id` | string | Primary key | Generated by Better Auth |
| `token` | string | Required, unique | Session token (used as bearer token or cookie value) |
| `userId` | string | Required, references `User.id` | Index for fast lookup |
| `expiresAt` | Date | Required, TTL index (14 days default) | Controls automatic expiry |
| `createdAt` | Date | Required | Audit timestamp |
| `updatedAt` | Date | Required | Last activity timestamp |
| `ipAddress` | string | Optional | Client IP for security monitoring |
| `userAgent` | string | Optional | Client user agent |

### Session Management
- **Cookie-based (Web)**: Session token stored in HTTP-only cookie `better-auth.session_token`
- **Bearer Token (Mobile/API)**: Session token sent in `Authorization: Bearer` header
- **Token Prioritization**: When both present, bearer token takes precedence
- **Expiration**: Better Auth automatically manages TTL indexes for session cleanup
- **Revocation**: Logout deletes session document; both cookie and bearer token become invalid

## Bearer Token Authentication

Better Auth's bearer plugin provides JWT-based authentication for mobile and API clients:

- **Token Format**: Session token doubles as bearer token (no separate JWT)
- **Delivery**: Returned in `set-auth-token` response header on registration/login
- **Usage**: Sent in `Authorization: Bearer <token>` header
- **Validation**: Better Auth validates token and loads associated session
- **Storage**: Client-side only (Secure Enclave / encrypted storage on mobile)
- **Expiration**: Tied to session expiration (14 days default)
- **Revocation**: Deleting session invalidates the bearer token

## Indexes (managed by Better Auth)

Better Auth automatically creates and manages all required indexes:
- `user.email` - Unique index with case-insensitive collation
- `session.token` - Unique index for fast token lookups
- `session.userId` - Index for user session queries
- `session.expiresAt` - TTL index for automatic session cleanup

## Relationships
- One `User` to many `Session` records
- Sessions reference users via `userId` field
- Better Auth handles all session-user relationships automatically
- Deleting a user should cascade to sessions (future enhancement)
